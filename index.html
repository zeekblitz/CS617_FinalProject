<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final</title>
    <style>
        .chartBox {
            width: 700px;
        }
    </style>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"
        integrity="sha512-vc58qvvBdrDR4etbxMdlTt4GBQk1qjvyORR2nrsPsFPyrs+/u5c3+1Ct6upOgdZoIl7eq6k3a1UPDSNAQi/32A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/roughjs@3.1.0/dist/rough.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-rough@0.2.0"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Indie+Flower">

    <div class="chartBox">
        <canvas id="myChart"></canvas>
    </div>

    <script>
        var file = 'BostonPetData.csv';
        var topBreeds = [];
        d3.csv(file).then(function (dataPoints) {
            // sort the data by neighborhood
            byNeighborhood = dataPoints.slice().sort((a, b) => d3.ascending(a.neighborhood, b.neighborhood));

            // separate the data into arrays by neighborhood
            var neighborhoods = [[]];
            var currentNeighborhood = byNeighborhood[0].neighborhood;
            for (let i = 0; i < byNeighborhood.length; i++) {
                if (byNeighborhood[i].neighborhood == currentNeighborhood) {
                    neighborhoods[neighborhoods.length - 1].push(byNeighborhood[i]);
                } else {
                    neighborhoods.push([]);
                    currentNeighborhood = byNeighborhood[i].neighborhood;
                    neighborhoods[neighborhoods.length - 1].push(byNeighborhood[i]);
                }
            }

            // determine the top 5 breeds for each neighborhood

            for (let i = 0; i < neighborhoods.length; i++) {
                var breedCounts = {};
                for (let j = 0; j < neighborhoods[i].length; j++) {
                    if (neighborhoods[i][j].Breed in breedCounts) {
                        breedCounts[neighborhoods[i][j].Breed]++;
                    } else {
                        breedCounts[neighborhoods[i][j].Breed] = 1;
                    }
                }
                var sortable = [];
                for (var breed in breedCounts) {
                    sortable.push([breed, breedCounts[breed]]);
                }
                sortable.sort(function (a, b) {
                    return b[1] - a[1];
                });
                topBreeds.push(sortable.slice(0, 5));
            }

            console.log(topBreeds[0]);
        });

        var chartColors = {
            red: 'rgb(255, 0, 0)',
            orange: 'rgb(255, 127, 0)',
            green: 'rgb(0, 127, 0)',
            blue: 'rgb(0, 0, 255)',
            purple: 'rgb(127, 0, 127)'
        };

        var labels = [];
        var datas = [];
        for (let i = 0; i < topBreeds[0].length; i++) {
            labels.push(topBreeds[0][i][0]);
            datas.push(topBreeds[0][i][1]);
        }

        var ctx = document.getElementById('myChart').getContext('2d');
        Chart.defaults.global.defaultFontFamily = '"Indie Flower", cursive';
        Chart.defaults.global.defaultFontSize = 16;
        var chart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: datas,
                    backgroundColor: [
                        chartColors.red,
                        chartColors.orange,
                        chartColors.green,
                        chartColors.blue,
                        chartColors.purple
                    ],
                    borderColor: [
                        chartColors.red,
                        chartColors.orange,
                        chartColors.green,
                        chartColors.blue,
                        chartColors.purple
                    ],
                    borderWidth: 3,
                    rough: {
                        roughness: 2,
                        bowing: .5,
                        fillStyle: 'zigzag',
                        fillWeight: 0.25,
                        hachureAngle: Math.floor(Math.random() * 90),
                        hachureGap: 7.5
                    }
                }]
            },
            plugins: [ChartRough],
            options: {
                title: {
                    display: true,
                    text: 'Neighborhood'
                },
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    </script>
</body>

</html>